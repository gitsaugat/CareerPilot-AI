{% extends "base.html" %}

{% block title %}Dashboard{% endblock %}

{% block content %}
<style>
  .rd-resume-list-card .card-body { border-radius: inherit; }
  .rd-resume-list { padding-left: 0; }
  .rd-resume-item {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 0.5rem;
    padding: 0.5rem 1rem;
    margin: 0 0.5rem;
    border-radius: 10px;
    transition: background 0.15s ease;
  }
  .rd-resume-item:hover { background: rgba(67, 160, 71, 0.08); }
  .rd-resume-item-link {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    flex: 1;
    min-width: 0;
    text-decoration: none;
    color: var(--rd-text-main, #1b5e20);
  }
  .rd-resume-item-link:hover { color: var(--rd-primary-dark, #2e7d32); }
  .rd-resume-icon { font-size: 1.1rem; flex-shrink: 0; }
  .rd-resume-name {
    font-size: 0.9rem;
    font-weight: 500;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }
  .rd-resume-actions {
    display: flex;
    align-items: center;
    gap: 0.25rem;
    flex-shrink: 0;
  }
  .rd-resume-btn {
    font-size: 0.75rem;
    padding: 0.2rem 0.5rem;
    border-radius: 6px;
    text-decoration: none;
    color: var(--rd-primary, #43a047);
    background: rgba(67, 160, 71, 0.12);
    border: none;
    cursor: pointer;
    transition: background 0.15s, color 0.15s;
  }
  .rd-resume-btn:hover {
    background: rgba(67, 160, 71, 0.22);
    color: var(--rd-primary-dark, #2e7d32);
  }
  .rd-resume-btn-danger {
    color: #c62828;
    background: rgba(198, 40, 40, 0.1);
  }
  .rd-resume-btn-danger:hover {
    background: rgba(198, 40, 40, 0.2);
    color: #b71c1c;
  }
</style>
<div class="row g-4 m-1">
  <!-- Left: two fixed-size cards stacked -->
  <div class="col-md-5 d-flex flex-column gap-3">
    <!-- Card 1: Upload form -->
    <div class="card shadow-sm flex-shrink-0" style="height: 380px;">
      <div class="card-body d-flex flex-column overflow-hidden">
        <h5 class="card-title mb-2">Upload Your Resume</h5>
        <form
          method="post"
          action="{{ url_for('upload_resume') }}"
          enctype="multipart/form-data"
          class="d-flex flex-column flex-grow-1 overflow-auto"
        >
          <div class="mb-2">
            <label for="name" class="form-label">Resume name</label>
            <input
              type="text"
              class="form-control form-control-sm"
              id="name"
              name="name"
              placeholder="e.g. John Doe - Backend Developer"
            />
          </div>
          <div class="mb-2">
            <label for="resume_text" class="form-label">Resume notes / text</label>
            <textarea
              class="form-control form-control-sm"
              id="resume_text"
              name="resume_text"
              rows="2"
              placeholder="Paste or write any notes..."
            ></textarea>
          </div>
          <div class="mb-2">
            <label for="resume_file" class="form-label">Resume file (PDF/DOC/DOCX)</label>
            <div
              id="dropbox"
              class="border border-2 border-dashed rounded p-3 text-center text-muted"
              style="min-height: 88px; cursor: pointer; transition: border-color 0.15s, background-color 0.15s;"
            >
              <input
                type="file"
                class="d-none"
                id="resume_file"
                name="resume_file"
                accept=".pdf,.doc,.docx"
                required
              />
              <div id="dropbox-text">
                <span class="d-block mb-0">Drag and drop or click</span>
              </div>
              <div id="dropbox-filename" class="d-none fw-medium text-body"></div>
            </div>
          </div>
          <button type="submit" class="btn btn-sm btn-primary mt-auto">Upload resume</button>
        </form>
      </div>
    </div>

    <!-- Card 2: Uploaded resumes list -->
    <div class="card shadow-sm flex-shrink-0 rd-resume-list-card" style="height: 320px;">
      <div class="card-body d-flex flex-column p-0 overflow-hidden">
        <div class="px-3 pt-3 pb-2 border-bottom border-opacity-25">
          <h5 class="card-title mb-0">Uploaded resumes</h5>
          <p class="text-muted small mb-0 mt-1">View, download, or remove</p>
        </div>
        <div class="flex-grow-1 overflow-auto">
          {% if resumes %}
          <ul class="rd-resume-list list-unstyled mb-0 py-2">
            {% for resume in resumes %}
            <li class="rd-resume-item">
              <a href="{{ url_for('dashboard', resume_id=resume.id) }}" class="rd-resume-item-link">
                <span class="rd-resume-icon">üìÑ</span>
                <span class="rd-resume-name" title="{{ resume.name }}">{{ resume.name }}</span>
              </a>
              <div class="rd-resume-actions">
                <a href="{{ url_for('dashboard', resume_id=resume.id) }}" class="rd-resume-btn" title="View">View</a>
                <a href="{{ url_for('download_resume', resume_id=resume.id) }}" class="rd-resume-btn" title="Download">Download</a>
                <form method="post" action="{{ url_for('delete_resume', resume_id=resume.id) }}" class="d-inline" onsubmit="return confirm('Delete this resume?');">
                  <button type="submit" class="rd-resume-btn rd-resume-btn-danger" title="Delete">Delete</button>
                </form>
              </div>
            </li>
            {% endfor %}
          </ul>
          {% else %}
          <div class="text-center py-5 px-3">
            <span class="d-block mb-2 opacity-50" style="font-size: 2rem;">üìÅ</span>
            <p class="text-muted small mb-0">No resumes yet</p>
            <p class="text-muted small mb-0">Upload one above</p>
          </div>
          {% endif %}
        </div>
      </div>
    </div>
  </div>

  <!-- Right: PDF viewer -->
  <div class="col-md-7">
    <div class="card shadow-sm h-100">
      <div class="card-body d-flex flex-column">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h4 class="card-title mb-0">Resume preview</h4>
          {% if selected_resume %}
          <a
            href="{{ url_for('compare_resume', resume_id=selected_resume.id) }}"
            class="btn btn-sm btn-outline-success"
          >
            Next
          </a>
          {% endif %}
        </div>

        {% if selected_resume %}
        <p class="text-muted mb-2">
          Selected: <strong>{{ selected_resume.name }}</strong>
        </p>
        {% endif %}

        <div class="flex-grow-1 d-flex align-items-stretch">
          {% if can_preview_pdf and viewer_url %}
          <div class="ratio ratio-4x3 w-100 border rounded">
            <iframe
              src="{{ viewer_url }}"
              title="Resume preview"
              style="border: 0;"
            ></iframe>
          </div>
          {% elif selected_resume %}
          <p class="text-muted">
            Preview is available only for PDF resumes. You can still download the file
            from the list on the left.
          </p>
          {% else %}
          <p class="text-muted mb-0">
            No resumes uploaded yet. Upload a PDF resume to see a live preview here.
          </p>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
</div>

<script>
(function () {
  var dropbox = document.getElementById("dropbox");
  var fileInput = document.getElementById("resume_file");
  var dropboxText = document.getElementById("dropbox-text");
  var dropboxFilename = document.getElementById("dropbox-filename");

  if (!dropbox || !fileInput) return;

  dropbox.addEventListener("click", function () {
    fileInput.click();
  });

  fileInput.addEventListener("change", function () {
    var file = fileInput.files[0];
    if (file) {
      dropboxText.classList.add("d-none");
      dropboxFilename.classList.remove("d-none");
      dropboxFilename.textContent = file.name;
    } else {
      dropboxText.classList.remove("d-none");
      dropboxFilename.classList.add("d-none");
    }
  });

  function highlight() {
    dropbox.style.borderColor = "var(--rd-primary, #43a047)";
    dropbox.style.backgroundColor = "rgba(67, 160, 71, 0.06)";
  }
  function unhighlight() {
    dropbox.style.borderColor = "";
    dropbox.style.backgroundColor = "";
  }

  dropbox.addEventListener("dragenter", function (e) {
    e.preventDefault();
    e.stopPropagation();
    highlight();
  });
  dropbox.addEventListener("dragover", function (e) {
    e.preventDefault();
    e.stopPropagation();
  });
  dropbox.addEventListener("dragleave", function (e) {
    e.preventDefault();
    e.stopPropagation();
    unhighlight();
  });
  dropbox.addEventListener("drop", function (e) {
    e.preventDefault();
    e.stopPropagation();
    unhighlight();
    var files = e.dataTransfer.files;
    if (files.length) {
      var file = files[0];
      var dt = new DataTransfer();
      dt.items.add(file);
      fileInput.files = dt.files;
      dropboxText.classList.add("d-none");
      dropboxFilename.classList.remove("d-none");
      dropboxFilename.textContent = file.name;
    }
  });
})();
</script>
{% endblock %}

